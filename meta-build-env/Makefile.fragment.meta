
SUFFIXES   =
CLEANFILES = 
EXTRA_DIST =

pkgconfigdir  = $(libdir)/pkgconfig
docdatadir    = $(datadir)/doc/$(PACKAGE)

EXTRA_DIST += $(wildcard *.m4) \
	     reconf \
	     Makefile.fragment.meta \
	     meta-build.ant 

CLEANFILES += $(PACKAGE)-uninstalled.pc 

DISTCLEANFILES+= \
			.project \
			.classpath \
			build.properties \
			.settings/org.eclipse.jdt.ui.prefs \
			.settings/org.eclipse.jdt.core.prefs \
			META-INF/MANIFEST.MF 

pkgconfig_DATA = $(PACKAGE).pc

JARFILE_ENV = JAR=$(JAVA_JAR)
data_DATA = $(JAVA_JAR)

export

dummy:

copyDir=\
	if [ -d $1/$2 ]; then \
	   cp -rf $1/$2 ${top_builddir}/installed; \
	fi

installDir: dummy
	mkdir -p ${top_builddir}/installed
	for dep in ${PACKAGE_ALL_DEPS}; do \
	        prefix=`pkg-config --variable prefix $${dep}`; \
		if [ ! -z $${prefix} ]; then \
	          $(call copyDir,$${prefix},bin); \
	          $(call copyDir,$${prefix},lib); \
	          $(call copyDir,$${prefix},share); \
	          $(call copyDir,$${prefix},libexec); \
		else  \
		  echo "prefix is empty" ; \
	          exit 1 ; \
	        fi ; \
	done
	SEDCMD="" ; \
	for dep in ${PACKAGE_ALL_DEPS}; do \
	        prefix=`pkg-config --variable prefix $${dep}`; \
	        newpath=`printf "%-$${#prefix}s" ".." | tr " " "/"` ; \
	        SEDCMD="$${SEDCMD} -e s@$${prefix}@$${newpath}@g"  ; \
	done ; \
	set -x ; \
	for file in `find installed -type f`; do \
          size=`wc -c $${file}` ; \
	  sed $${SEDCMD} < $${file} > $${file}.tmp ;\
	  dd bs=1 count="$${size}" if=$${file}.tmp of=$${file} ; \
          rm $${file}.tmp ; \
	done
	
${JAVA_JAR}: installDir
	jar -cMf ${JAVA_JAR} META-INF/MANIFEST.MF installed

clean-local:
	rm -f ${JARFILE}
	rm -rf installed
