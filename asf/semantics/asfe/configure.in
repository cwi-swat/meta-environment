dnl
dnl    Evaluator - the ASF interpreter
dnl    Copyright (C) 2000  Stichting Mathematisch Centrum, Amsterdam, The Netherlands.
dnl
dnl    This program is free software; you can redistribute it and/or modify
dnl    it under the terms of the GNU General Public License as published by
dnl    the Free Software Foundation; either version 2 of the License, or
dnl    (at your option) any later version.
dnl
dnl    This program is distributed in the hope that it will be useful,
dnl    but WITHOUT ANY WARRANTY; without even the implied warranty of
dnl    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
dnl    GNU General Public License for more details.
dnl
dnl    You should have received a copy of the GNU General Public License
dnl    along with this program; if not, write to the Free Software
dnl    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
dnl
dnl $Id$

dnl Process this file with autoconf to produce a configure script.
AC_INIT(Makefile.in)
AM_INIT_AUTOMAKE(evaluator, 0.1)

dnl Handle --with-layout 
AC_ARG_WITH(layout,
   [  --with-layout           evaluator keeps layout while rewriting],
   LAYOUTDEF=-DKEEP_LAYOUT
)  
AC_SUBST(LAYOUTDEF)

dnl Handle --with-traversals
AC_ARG_WITH(traversals,
   [  --with-traversals       evaluator implements traveral functions],
   TRAVERSALSDEF=-DTRAVERSALS
)
AC_SUBST(TRAVERSALSDEF)


AC_PATH_PROG(ATERM, baffle, no)
if test "${ATERM}" = "no"; then
	ATERM='${prefix}'
else
	ATERM=`dirname \`dirname ${ATERM}\``
fi

ASFIX=
AC_PATH_PROG(ASFIX, afexpand, no)
if test "${ASFIX}" = "no"; then
	ASFIX='${prefix}'
else
	ASFIX=`dirname \`dirname ${ASFIX}\``
fi

AC_PATH_PROG(TOOLBUS, toolbus, no)
if test "${TOOLBUS}" = "no"; then
	TOOLBUS='${prefix}'
else
	TOOLBUS=`dirname \`dirname ${TOOLBUS}\``
fi

dnl Is ranlib needed on this system?
AC_PROG_RANLIB
AC_PATH_PROG(AR,ar,/usr/bin/ar)

dnl Which compiler to use?
AC_PROG_CC

dnl What commands are needed to set the variable MAKE in Makefiles?
AC_SET_MAKE

dnl Handle --with-aterm=... argument to configure
AC_ARG_WITH(aterm,
[  --with-aterm=DIR        ATerm-library is in DIR],
   ATERM=${withval},)
AC_SUBST(ATERM)

AC_ARG_WITH(aterm-bin,
   [  --with-aterm-bin=DIR    ATerm executables are in DIR],
   ATERMBIN=${withval},ATERMBIN=${ATERM}/bin)
AC_SUBST(ATERMBIN)

AC_ARG_WITH(aterm-lib,
   [  --with-aterm-lib=DIR    ATerm libraries are in DIR],
   ATERMLIB=${withval},ATERMLIB=${ATERM}/lib)
AC_SUBST(ATERMLIB)

AC_ARG_WITH(aterm-inc,
   [  --with-aterm-inc=DIR    ATerm header files are in DIR],
   ATERMINC=${withval},ATERMINC=${ATERM}/include)
AC_SUBST(ATERMINC)

dnl Handle --with-asfix=... argument to configure
AC_ARG_WITH(asfix,
[  --with-asfix=DIR        AsFix-library is in DIR],
   ASFIX=${withval},)
AC_SUBST(ASFIX)

AC_ARG_WITH(asfix-bin,
   [  --with-asfix-bin=DIR    AsFix executables are in DIR],
   ASFIXBIN=${withval},ASFIXBIN=${ASFIX}/bin)
AC_SUBST(ASFIXBIN)

AC_ARG_WITH(asfix-lib,
   [  --with-asfix-lib=DIR    AsFix libraries are in DIR],
   ASFIXLIB=${withval},ASFIXLIB=${ASFIX}/lib)
AC_SUBST(ASFIXLIB)

AC_ARG_WITH(asfix-inc,
   [  --with-asfix-inc=DIR    AsFix header files are in DIR],
   ASFIXINC=${withval},ASFIXINC=${ASFIX}/include)
AC_SUBST(ASFIXINC)

AC_ARG_WITH(asc,
[  --with-asc=DIR        ASF+SDF compiler runtime-library is in DIR],
   ASC=${withval},)
AC_SUBST(ASC)

AC_ARG_WITH(asc-lib,
   [  --with-asc-lib=DIR    ASF+SDF compiler runtime-library is in DIR],
   ASCLIB=${withval},ASCLIB=${ASC}/lib)
AC_SUBST(ASCLIB)

AC_ARG_WITH(asC-inc,
   [  --with-asc-inc=DIR    ASF+SDF compiler runtime-library header files are in DIR],
   ASCINC=${withval},ASCINC=${ASC}/include)
AC_SUBST(ASCINC)

dnl Handle --with-toolbus[-...]=... arguments to configure
AC_ARG_WITH(toolbus,
   [  --with-toolbus=DIR      ToolBus distribution is in DIR],
   TOOLBUS=${withval},)
AC_SUBST(TOOLBUS)

AC_ARG_WITH(toolbus-bin,
   [  --with-toolbus-bin=DIR  ToolBus executables are in DIR],
   TOOLBUSBIN=${withval},TOOLBUSBIN=${TOOLBUS}/bin)
AC_SUBST(TOOLBUSBIN)

if test "a${TOOLBUS}" = "a"; then
 dnl Default locations of used components
 AC_PATH_PROG(TOOLBUS, toolbus, no)
 if test "${TOOLBUS}" = "no"; then
  echo "Warning: toolbus not found. You might need it when developing the ASF evaluator." >&2
  TOOLBUS=
  TOOLBUSBIN=
 else
  TOOLBUSBIN=`dirname ${TOOLBUS}`
  TOOLBUS=`dirname ${TOOLBUSBIN}`
 fi
fi

dnl Determine which libraries to use for programs using sockets
NOSOCKLIBS=$LIBS
dnl first, the socket functions
SOCKET_FOUND=no
SOCKLIBS=
AC_CHECK_LIB(sun,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsun"])
if test ${SOCKET_FOUND} = no; then
  AC_CHECK_LIB(socket,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsocket"])
  if test ${SOCKET_FOUND} = no; then
    AC_CHECK_LIB(bsd,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lbsd";DEFS="$DEFS -D_BSD=43"])
  fi
fi

dnl then gethostname
GHN_FOUND=no
AC_CHECK_LIB(sun,gethostname,[GHN_FOUND=yes])
if test ${GHN_FOUND} = no; then
  AC_CHECK_LIB(nsl,gethostname,[GHN_FOUND=yes;SOCKLIBS="$SOCKLIBS -lnsl"])
fi

LIBS=$NOSOCKLIBS
AC_CHECK_LIB(dl, dlopen)

dnl Checks for header files.
AC_CHECK_HEADER(getopt.h)

AC_SUBST(SOCKLIBS)

dnl Which files need updating?
AC_OUTPUT(
   Makefile
   src/Makefile
   test/Makefile
   test/terms/Makefile
   test/eqs/Makefile
   test/fail/Makefile
   test/ref/Makefile
)
