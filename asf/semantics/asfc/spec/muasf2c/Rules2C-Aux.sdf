%%
%%    Meta-Environment - An environment for language prototyping.
%%    Copyright (C) 2000  Stichting Mathematisch Centrum, Amsterdam, The Netherlands. 
%%
%%    This program is free software; you can redistribute it and/or modify
%%    it under the terms of the GNU General Public License as published by
%%    the Free Software Foundation; either version 2 of the License, or
%%    (at your option) any later version.
%%
%%    This program is distributed in the hope that it will be useful,
%%    but WITHOUT ANY WARRANTY; without even the implied warranty of
%%    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
%%    GNU General Public License for more details.
%%
%%    You should have received a copy of the GNU General Public License
%%    along with this program; if not, write to the Free Software
%%    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
%%
%%  Rules2C-Aux
module Rules2C-Aux

imports C-Basics MuASF-Equations-Ops

exports
  sorts C-Rule C-RuleList C-RuleListPair FV-Path FV-PathList PathList-Cenv
        SlI-tuple SRI-tuple C-RuleListTriple
  context-free syntax
    "(" Term "," {IntCon ","}+ ")"                              -> FV-Path
    {FV-Path ","}*                                            -> FV-PathList
    "(" {FV-Path ","}+ ")"                                    -> FV-Path
    "[" {FV-Path ","}* "|" {Cond "&"}* "|"
        Term "|" C-env "|" C-env "|" FunId "]"                -> C-Rule
    {C-Rule ";"}*                                             -> C-RuleList
    "(" {C-Rule ";"}* "," {C-Rule ";"}* ")"                   -> C-RuleListPair
    "(" {C-Rule ";"}* "," {C-Rule ";"}* "," {C-Rule ";"}* ")" -> C-RuleListTriple
    "(" FV-PathList "," C-env ")"                             -> PathList-Cenv
    "(" Statement-list-opt "," Statement-list-opt ","
        {C-Rule ";"}* "," IntCon ")"                          -> SRI-tuple
    "(" Statement-list-opt "," IntCon ")"                     -> SlI-tuple

exports
  context-free syntax
    make-c-rules({Rule ";"}*)                           -> C-RuleList
    make-c-rule(Rule)                                   -> C-Rule
    code-args({Term ","}*,{IntCon ","}*)                -> PathList-Cenv
    funargs2cexp({Term ","}+,IntCon)                    -> C-env
    make-c-expression(FunId,Expression,{NamePair ","}*) -> Expression
    make-c-expression(FV-Path,{NamePair ","}*)          -> Expression
    get-ofs({C-Rule ";"}+)                              -> FunId

exports
  context-free syntax
    select-on-ofs(FunId,{Rule ";"}*)                   -> RuleListPair
    select-on-defaults({Rule ";"}*)                    -> RuleListPair
    select-on-ofs-first-arg({C-Rule ";"}*)             -> C-RuleListPair
    select-on-ofs-first-arg(FunId,{C-Rule ";"}*)       -> C-RuleListTriple
    select-on-same-list-pat({C-Rule ";"}*)             -> C-RuleListPair
    select-on-same-list-pat(FV-Path,{C-Rule ";"}*)     -> C-RuleListPair
    select-on-conds({C-Rule ";"}*)                     -> C-RuleListPair
    select-same-lhs-cond(C-Rule,{C-Rule ";"}*)         -> C-RuleListPair
    select-same-rhs-cond(C-Rule,{C-Rule ";"}*)         -> C-RuleListPair
    select-conds-on-first-term(Term,{C-Rule ";"}*)     -> C-RuleListPair
    select-conds-on-second-term(Term,{C-Rule ";"}*)    -> C-RuleListPair
    replace-first-term(Term,C-env,{C-Rule ";"}*)       -> C-RuleList
    replace-second-term(Term,C-env,{C-Rule ";"}*)      -> C-RuleList
    remove-ofs-first-arg({C-Rule ";"}*)                -> C-RuleList
    remove-first-arg({C-Rule ";"}*)                    -> C-RuleList
    remove-first-cond({C-Rule ";"}*)                   -> C-RuleList
    remove-first-cond-and-add-env({C-Rule ";"}*,C-env) -> C-RuleList
    add-env({C-Rule ";"}*,C-env)                       -> C-RuleList

exports
  context-free syntax
    get-first-vf-path({C-Rule ";"}+)     -> FV-Path
    is-empty-vf-path({C-Rule ";"}*)      -> Bool
    is-single-vf-path({C-Rule ";"}*)     -> Bool
    make-atmp({IntCon ","}*)             -> Identifier
    make-atmp2({IntCon ","}+)            -> Identifier
    make-select-stat({IntCon ","}*)      -> Declaration-list-opt
    make-ignored-select-stat({IntCon ","}*) -> Declaration-list-opt

    make-array-decl({IntCon ","}+)       -> Declaration-list
    make-decl({IntCon ","}+)             -> Declaration-list
    make-tmp-array(IntCon)               -> Declaration-list-opt
    make-ltmp-array(IntCon)              -> Declaration-list-opt
    cnt-args({Expression ","}*)          -> Int

exports
  context-free syntax
    make-cond(Expression,
              Statement-list-opt,Statement-list-opt)       -> Statement-list-opt
    make-cond(Expression,Statement-list-opt)               -> Statement-list-opt
    make-cond(Statement-list-opt,Statement-list-opt)       -> Statement-list-opt
    make-if-then-else(Term,Expression, Statement-list-opt,
                      Statement-list-opt)                  -> Statement-list-opt
    make-if-then-else(Expression, Statement-list-opt)      -> Statement-list-opt

hiddens
  context-free syntax
    remove-c-brackets(Statement-list-opt) -> Statement-list-opt

exports
  variables
    "C-rule"[0-9]*     -> C-Rule
    "C-rule*"[0-9]*    -> {C-Rule ";"}*
    "C-rule+"[0-9]*    -> {C-Rule ";"}+
    "Fv-path"[0-9]*    -> FV-Path
    "Fv-path*"[0-9]*   -> {FV-Path ","}*
    "Fv-path+"[0-9]*   -> {FV-Path ","}+
    "Aint*"[0-9]*      -> {IntCon ","}*
    "Aint+"[0-9]*      -> {IntCon ","}+
    "Aset"[0-9]*       -> A-set
    "Aexp"[0-9]*       -> Expression
    "Expr"[0-9]*       -> Expression
    "Expression"[0-9]* -> Expression
    "Eipair"[0-9]*     -> EI-pair
    "Eipair*"[0-9]*    -> {EI-pair ","}*
    "Eipair+"[0-9]*    -> {EI-pair ","}+
    "Cint"[0-9]*       -> Integer-constant
hiddens
  variables
    "Char"[0-9]*    -> CHAR
    "Char*"[0-9]*   -> CHAR*
    "Char+"[0-9]*   -> CHAR+
    "Ct-lhs"[0-9]*  -> Term
    "Ct-rhs"[0-9]*  -> Term
