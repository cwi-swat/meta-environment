# Directory: compiler/c-source

# Configure variable substitutions
PRODUCT     = new-meta
VERSION     = 0.02

srcdir      = .
top_srcdir  = ../..
prefix      = /home/markvdb/NEW-META/
exec_prefix = ${prefix}
bindir      = $(exec_prefix)/bin
libdir      = $(exec_prefix)/lib
includedir  = $(prefix)/include
docdir      = $(top_srcdir)/docs

SHELL       = /bin/sh
CC          = cc
MAKE        = gmake
CFLAGS      = -O ${XCFLAGS}
DEFS        =  -DHAVE_LIBDL=1  ${XDEFS}
INCLUDES    =  ${XINCLUDES}
LIBS        = -ldl  ${XLIBS}
SOCKLIBS    = -lsocket -lnsl

INSTALL     = $(top_srcdir)/install-sh
INSTALL_DATA= $(top_srcdir)/install-data-sh
INSTALL_PROG= $(top_srcdir)/install-prog-sh
UNINSTALL   = $(top_srcdir)/uninstall-sh

AR          = ar

ATERM       = /home/markvdb/NEW-META/aterm

include Make.modules

CC	= cc
INCLUDE = -I$(ATERM)/aterm -I$(ATERM)/asfix -I$(ATERM)/toolbus \
          -I/home/markvdb/NEW-META/new-meta/compiler/support
CFLAGS	= -O $(INCLUDE)
LIBS	= -L$(ATERM)/aterm  -L$(ATERM)/asfix -L$(ATERM)/toolbus \
        -lATerm-cc -lAsFix-cc -lATB-cc -L../support -lsupport-cc \
	-lsocket -lnsl 
LFLAGS	=  
AR	= ar

BASE	= ..
PPC	= $(BASE)/clib/ppc

FILES	:= $(notdir $(ASFIX))
NAMES   := $(patsubst %.asfix,%,$(FILES))
CSRC	:= $(patsubst %.asfix,%.c,$(FILES)) 
MODS	:= init.o $(patsubst %.asfix,%.o,$(FILES))
INIT	:= $(patsubst %.asfix,%();,$(FILES))
REGALL	:= $(patsubst %,register_%,$(INIT))
EREGALL	:= $(patsubst %,extern void register_%,$(INIT))
RESALL	:= $(patsubst %,resolve_%,$(INIT))
ERESALL := $(patsubst %,extern void resolve_%,$(INIT))

all: libasfix2c.a

libasfix2c.a: $(MODS)
	$(AR) cr libasfix2c.a $(MODS)
%.o: %.c
	$(CC) $(CFLAGS) -c $<

init.o: init.c

init.c:
	../mk-init.sh >> $@
