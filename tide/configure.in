
AC_INIT(configure.in)
AM_INIT_AUTOMAKE(tide, 0.5beta)

ACLOCAL="${ACLOCAL} -I ."

dnl Which compiler to use?
AC_PROG_CC
AC_SET_MAKE

dnl Handle --with-cflags option
AC_ARG_WITH(cflags,
   [  --with-cflags=CFLAGS    standard options of c compiler],
   CFLAGS=${withval},
   if test "a${GCC}" = "ayes"; then
     CFLAGS="-Wall -g -O2"
   fi;
)
AC_SUBST(CFLAGS)

dnl Development mode
AC_ARG_WITH(develop,
   [  --with-develop          Enable development mode (extra dbg prints etc.)],
   DEVELOP_DEF=-DDEVELOP=1,
)
AC_SUBST(DEVELOP_DEF)


dnl Is ranlib needed on this system?
AC_PROG_RANLIB
AC_PATH_PROG(AR,ar,/usr/bin/ar)

dnl Require ATerm library
AC_PACKAGE_REQUIRE(aterm, baffle,
   [  --with-aterm=DIR        Specify location of the ATerm library])
AC_SUBST(ATERM)

AC_PACKAGE_REQUIRE(aterm-java, aterm-java-config,
        [  --with-aterm-java=DIR  ATerm-Java-library is in DIR])
JAVA_ATERM=`${ATERM_JAVA}/bin/aterm-java-config`
AC_SUBST(JAVA_ATERM)

dnl Require ToolBus library
AC_PACKAGE_REQUIRE(toolbuslib, toolbuslib-config,
   [  --with-toolbuslib=DIR      ToolBus library is in DIR])
AC_SUBST(TOOLBUSLIB)

dnl Require toolbus package
AC_PACKAGE_REQUIRE(toolbus, toolbus,
   [  --with-toolbus=DIR      Specify location of the ToolBus])
AC_SUBST(TOOLBUS)

dnl Form CLASSPATH for external jars and classes
EXTERNAL_JARS=${JAVA_ATERM}:${TOOLBUS}/classes
AC_SUBST(EXTERNAL_JARS)

dnl Find out which libraries we need
SOCKET_FOUND=no
AC_CHECK_LIB(sun,socket,[SOCKET_FOUND=yes;LIBS="$LIBS -lsun"])
if test ${SOCKET_FOUND} = no; then
   AC_CHECK_LIB(socket, socket,[SOCKET_FOUND=yes;LIBS="$LIBS -lsocket"])
   if test ${SOCKET_FOUND} = no; then
      AC_CHECK_LIB(bsd,
                   socket,
                   [SOCKET_FOUND=yes;LIBS="$LIBS -lbsd";DEFS="$DEFS -D_BSD=43"]
)
   fi
fi

AC_CHECK_LIB(dl, dlopen)

GETHOSTNAME_FOUND=no
AC_CHECK_LIB(sun,gethostname,[GETHOSTNAME_FOUND=yes])
if test ${GETHOSTNAME_FOUND} = no; then
   AC_CHECK_LIB(nsl,gethostname,[GETHOSTNAME_FOUND=yes;LIBS="$LIBS -lnsl"])
fi

AC_OUTPUT( \
	Makefile \
	scripts/Makefile \
	toolbus/Makefile \
	lib-c/Makefile \
	tide/Makefile \
	tide/tool/Makefile \
	tide/tool/support/Makefile \
	tide/tool/proclist/Makefile \
	tide/tool/ruleinspector/Makefile \
	tide/tool/srcviewer/Makefile \
	tide/tool/prefeditor/Makefile \
	tide/tool/stackviewer/Makefile \
	images/Makefile \
	META-INF/Makefile \
        examples/Makefile \
	examples/pico/Makefile \
	, )
