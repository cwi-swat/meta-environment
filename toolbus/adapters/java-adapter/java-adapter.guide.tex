
\section{\label{ToolsInJava}Writing tools in Java}

Java \TB\ tools can be written using the {\tt toolbus} API
consisting of the following Java packages:

\begin{itemize}
\item {\tt toolbus.aterm} - The basic term package.
\item {\tt toolbus.tool} - The ToolBus connection package.
\end{itemize}

A Java \TB\ tool is created by subclassing the {\tt toolbus.tool.Tool}
class, and overriding the {\tt handler} method. This method is called
whenever the \TB\ sends a term to the tool.

In order to avoid the tedious use of matching to differentiate between
the different terms that the tool can receive, an abstract subclass of 
{\tt toolbus.tool.Tool} can be generated automatically for a specific
case using {\tt javatif}. By subclassing this abstract subclass and
overriding all the generated abstract handler functions you can create
your own tool.

\subsection{Building the {\tt java-adapter}}
In order to build and install the Java \TB\ support, you need to
use the {\tt --with-java=\emph{classdir}} or {\tt --with-java} option
when {\emph configuring} the \TB. The second alternative uses a
default \emph{classdir} of {\tt \$HOME/classes}. The \emph{classdir}
is used to store all the class files that make up the \TB\ packages.
Make sure your {\tt CLASSPATH} variable is set correctly, and {\tt java},
{\tt javac} and {\tt javadoc} are in your {\tt PATH} before building the
\TB\ with Java support enabled. After you have done a {\tt make}, and 
{\tt make install}, the class files are installed in \emph{classdir} (which
is typically located somewhere in your {\tt CLASSPATH}, and two scripts called 
{\tt java-adapter} and {\tt javatif} are installed in the \TB\ bin directory.

\subsection{\label{java-adapter}{\tt java-adapter}}

\paragraph{Synopsis.} Execute {\tt java} as a \TB\ tool, 
and load a specific {\tt Tool} class.}

\paragraph{Example.} {\tt java-adapter -class MyFirstTool}

\paragraph{Specific arguments.}
\begin{itemize}
\item {\tt -class $Class$}: Use $Class$ as the tool class to load (mandatory).
\item {\tt -program $Prg$}: Use $Prg$ instead of {\tt java} as the java byte-code
	interpreter.
\item {\tt -arg $Arg$}: Send $Arg$ as an argument to the java byte-code
	interpreter. This can be used to change stack size etc.
\item {\tt -java-args $Args$}: Send $Args$ as arguments to the java program.
	This must be the last option.
\end{itemize}

\subsection{\label{javatif}{\tt javatif}}

\paragraph{Synopsis.} Generate a subclass of {\tt toolbus.tool.Tool}
geared towards a specific tool interface.

\paragraph{Example.} {\tt javatif -tool first-tool -tifs first.tifs}

\paragraph{Specific arguments.}
\begin{itemize}
\item {\tt -tool $Tool$}: The tool for which to generate the class (mandatory).
\item {\tt -tifs $File$}: The tifs file from which to distill the tool's interface
	(mandatory).
\item {\tt -package $Package$}: The fully qualified package name of the newly
	created class.
\item {\tt -class $Name$}: The class name of the newly created class. If this
    	option is not supplied the class name is deduced from the tool name
	by capitalizing the first letter of the tool name and all letters
	following a dash ({\tt -}), and removing all dashes.
\end{itemize}

\subsection{API documentation}

Extensive documentation of the {\tt toolbus} API classes can be found
in the \TB\ {\tt doc/classes} directory in the form of a set of HTML
pages generated by {\tt javadoc}. Here we will only present an example
tool written in Java to explain the basic techniques.

\subsection{Example}

Lets rewrite the {\tt hello world} tool in Java. First we need to
generate a subclass of {\tt toolbus.tool.Tool} using {\tt javatif},
using the following command:

\begin{verbatim}
javatif -tool hello -tifs hello2.tifs
\end{verbatim}

This generates the file Hello.java:

\input{../demos/hello/Hello.java}

Now we subclass the {\tt Hello} class and override the following 
abstract methods:

\begin{verbatim}
  abstract ATermRef getText() throws ToolException;
  abstract void recTerminate(ATermRef t0) throws ToolException;
\end{verbatim}

We have done this using the class {\tt HelloTool} in the
file {\tt HelloTool.java}:

\input{../demos/hello/HelloTool.java}

