# The following variables are instantiated using the configure script
# generated by autoconf:

PRODUCT		= @PRODUCT@
VERSION		= @VERSION@

srcdir		= @srcdir@
VPATH		= @srcdir@
top_srcdir      = @top_srcdir@

prefix          = @prefix@
exec_prefix     = @exec_prefix@
bindir          = $(exec_prefix)/bin
libdir          = $(exec_prefix)/lib
docdir		= $(top_srcdir)/doc
includedir      = $(prefix)/include

SHELL		= /bin/sh

CC		= @CC@
CFLAGS		=
INCLUDES	= @INCLUDES@ -I$(top_srcdir)/src $(EXTRA_INCLUDES)
DEFS		= @DEFS@ $(EXTRA_DEFS)

INSTALL		= @INSTALL@

CLEAN		= @CLEAN@
GELOBJECTS	= @GELOBJECTS@ bgelio bgelo
LIBS		= $(EXTRA_LIBS) $(top_srcdir)/src/libtb.a @LIBS@

NOWEB		= @NOWEB@
EP		= @EPDIR@
ARM		= @EPDIR@/uarm

COMPILE 	= $(CC) $(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS)

DISTFILES	= Makefile.in arm-resident.in arm-cmd $(SOURCE) $(DOC) \
		$(SRCDOC) $(GENSRC)

# With a little bit of luck, you only have to change the value of
# these variables, and add some rules to actually build your programs:
ADAPTER-NAME    = arm-adapter
PROGRAMS        = arm-adapter armcmd arm-cmd arm-resident
SOURCE          = arm-adapter.c.nw armcmd.c.nw arm.tb.nw
LIBFILES        = arm.tb
DOC             = arm-adapter.guide.tex
SRCDOC          = arm-adapter.c.tex arm.tb.tex
GENSRC          = arm-adapter.c arm-adapter.h arm.tb

EXTRA_INCLUDES	= -I$(ARM)
EXTRA_DEFS	=
EXTRA_LIBS	= -L$(ARM) -ldarm

# Here you can add the rules that actually build your adapter:

all:	${PROGRAMS} $(LIBFILES) $(SRCDOC) ${DOC} 

arm.tb arm.tb.tex: arm.tb.nw
	$(NOWEB) arm.tb.nw
	touch arm.tb arm.tb.tex

arm-adapter: arm-adapter.o
	$(CC) -o arm-adapter arm-adapter.o $(LIBS)

arm-adapter.o: arm-adapter.c arm.tif.c
	$(COMPILE) -c arm-adapter.c

arm-adapter.c arm-adapter.h: arm-adapter.c.nw
	$(NOWEB) arm-adapter.c.nw
	touch arm-adapter.c arm-adapter.h

arm.tif.c: arm.tifs
	ctif -newstyle -tool arm -tifs arm.tifs 

arm.tifs: arm.tb
	toolbus -gentifs arm.tb

armcmd: armcmd.o
	$(CC) -o armcmd armcmd.o $(LIBS)

armcmd.o: armcmd.c armcmd.tif.c
	$(COMPILE) -c armcmd.c

armcmd.tif.c: arm.tifs
	ctif -newstyle -tool armcmd -tifs arm.tifs

armcmd.c armcmd.c.tex: armcmd.c.nw
	$(NOWEB) armcmd.c.nw
	touch armcmd.c armcmd.c.tex


# The rules below this line are general rules and are based on the
# defines listed above. You probably won't have to change them.

clean:
	${CLEAN} ${PROGRAMS}

distclean: clean

dist: $(DISTFILES)
	@for file in $(DISTFILES); do \
	  ln $(srcdir)/$$file $(top_srcdir)/../$(PRODUCT)-$(VERSION)/adapters/$(ADAPTER-NAME) 2> /dev/null \
	  || cp $(srcdir)/$$file $(top_srcdir)/../$(PRODUCT)-$(VERSION)/adapters/$(ADAPTER-NAME); \
	done

install: $(PROGRAMS) $(LIBFILES)
	for file in $(PROGRAMS); do\
	  $(INSTALL) $$file $(bindir); \
	done
	for file in $(LIBFILES); do\
	  $(INSTALL) $$file $(libdir); \
	done

doc: $(SRCDOC) $(DOC)
	for file in $(SRCDOC); do\
	  $(INSTALL) $$file $(docdir)/src; \
	done
	for file in $(DOC); do\
	  $(INSTALL) $$file $(docdir)/adapters; \
	done

uninstall:
	for file in $(PROGRAMS); do\
	  rm -f $(bindir)/$$file; \
	done
	for file in $(SRCDOC); do\
	  rm -f $(docdir)/src/$$file;\
	done
	for file in $(DOC); do\
	  rm -f $(docdir)/adapters/$$file; \
	done
	for file in $(LIBFILES); do\
	  rm -f $(libdir)/$$file;\
	done 

