#!/bin/sh
# $Id$

prefix=@prefix@
exec_prefix=@exec_prefix@
bindir=${exec_prefix}/bin
libdir=${exec_prefix}/lib

PATH="$PATH:$bindir"

PARSER="parse-sdf2 -1 -v"
GENERATOR="gen-table"

VERBOSE=1;
ERROR=0;

Notify () {
        if [ $VERBOSE -gt 0 ]
        then
                echo $*                                   >&2
        fi
}


while [ $# -gt 0 ]	# Handle command line options
do
	case $1
	in
		-v*)
			VERBOSE=0
			OPTS="$OPTS $1" ;;
		-*)
			echo Unknown option ignored: $1 ;;
		*)
			Files="$Files $1" ;;
	esac
	shift
done

for f in $Files
do
	base=`dirname $f`/`basename $f .sdf2`
	af1name=$base.asfix1
	tblname=$base.tbl
	Notify "Parsing $f..."
	if $PARSER $OPTS $f -o $af1name
	then
	        Notify "Generating parse table ..."
	        if $GENERATOR $OPTS $af1name
		then
			rm -f $af1name
		else
			echo "Error rewriting $f"	>&2	
			ERROR=1
		fi
	else
		echo "Error parsing $f"			>&2
		ERROR=1
	fi
done

exit $ERROR;
