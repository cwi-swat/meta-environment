dnl Process this file with autoconf to produce a configure script.
AC_INIT(configure.in)
AM_INIT_AUTOMAKE(meta, 0.11)
AC_PREREQ(2.13)

dnl Let aclocal use macros in ./config directory
ACLOCAL="${ACLOCAL} -I ./config"

dnl Which compiler to use?
AC_REQUIRE([AC_PROG_CC])
AC_PROG_CC

dnl Handle cflags option
AC_ARG_WITH(cflags,
   [  --with-cflags=CFLAGS    standard options of c compiler],
   CFLAGS=${withval},
   if test "a${GCC}" = "ayes"; then
     CFLAGS="-Wall -g -O2"
   fi;
)
AC_SUBST(CFLAGS)

dnl Check for required packages and perform version checks when needed.

dnl Try to find xemacs
AC_PACKAGE_REQUIRE(xemacs, xemacs,
   [  --with-xemacs=DIR       Xemacs is in DIR])
AC_SUBST(XEMACS)

dnl Require ATerm library
AC_PACKAGE_REQUIRE(aterm, baffle,
   [  --with-aterm=DIR        ATerm-library is in DIR])
AC_SUBST(ATERM)

dnl Require Shared-Object library
AC_PACKAGE_REQUIRE(shared-objects, shared-objects-config,
   [  --with-shared-objects=DIR Shared-Objects-library is in DIR])
SHARED_OBJECTS="${SHARED_OBJECTS}/share/shared-objects-1.1beta.jar"
AC_SUBST(SHARED_OBJECTS)

dnl Require ATerm Java library
AC_PACKAGE_REQUIRE(aterm-java, aterm-java-config,
   [  --with-aterm-java=DIR   ATerm-javalibrary is in DIR])
dnl ATERM_JAVA is not allowed in Makefile.am's
JAVA_ATERM="${ATERM_JAVA}/share/aterm-1.1beta.jar"
AC_SUBST(JAVA_ATERM)

dnl Require ToolBus library
AC_PACKAGE_REQUIRE(toolbuslib, toolbuslib-config,
   [  --with-toolbuslib=DIR   ToolBus library is in DIR])
AC_SUBST(TOOLBUSLIB)

dnl Require toolbus package
AC_PACKAGE_REQUIRE(toolbus, toolbus,
   [  --with-toolbus=DIR      ToolBus distribution is in DIR])
AC_SUBST(TOOLBUS)

dnl Require sglr package
AC_PACKAGE_REQUIRE(sglr, sglr,
   [  --with-sglr=DIR         sglr is in DIR])
AC_SUBST(SGLR)

dnl Require pgen package
AC_PACKAGE_REQUIRE(pgen, sdf2table,
   [  --with-pgen=DIR         pgen is in DIR])
AC_SUBST(PGEN)

dnl Require pt-support package
AC_PACKAGE_REQUIRE(pt-support, unparsePT,
   [  --with-pt-support=DIR   pt-support is in DIR])
AC_SUBST(PT_SUPPORT)

dnl Require sdf-support package
AC_PACKAGE_REQUIRE(sdf-support, sdf-support-config,
   [  --with-sdf-support=DIR  sdf-support is in DIR])
AC_SUBST(SDF_SUPPORT)

dnl Handle --enable-metastudio argument to configure
AC_ARG_ENABLE(metastudio,
[  --enable-metastudio     Use Swing GUI instead of Tk GUI],
METASTUDIO_DEF=-DMETASTUDIO
UI_PACKAGE=meta-studio,
UI_PACKAGE=graph-browser
)

AC_SUBST(METASTUDIO_DEF)
AC_SUBST(UI_PACKAGE)

AC_PACKAGE_REQUIRE(java, java,
   [  --with-java=DIR         Java (and Swing) are in DIR (jdk-1.4 and up).],
      JAVADIR=,)
AC_SUBST(JAVA)

dnl Check for wish program
AC_PACKAGE_REQUIRE(tk, wish8.3 wish8.2 wish8.1 wish8.0 wish,
   [  --with-tk=DIR           Tk package is in DIR],)
META_WISH_VERSION_CHECK($TK)
AC_SUBST(WISH)

dnl Check for graphviz package
AC_ARG_WITH(graphviz,
   [  --with-graphviz=DIR     graphviz package is in DIR],
   GRAPHVIZ=${withval},
   GRAPHVIZ=""
)
  
dnl Only check version if location of graphviz is determined automagically
if test x${GRAPHVIZ} = "x"; then
  AC_PATH_PROGS(GRAPHVIZ, dot)
  if test x${GRAPHVIZ} = "x"; then
     AC_ERROR( [ Required package \"graphviz\" not found and not specified with --with-graphviz configuration switch. ])
  fi     
  GRAPHVIZ=`dirname ${GRAPHVIZ}`
  GRAPHVIZ=`dirname ${GRAPHVIZ}`
  META_GRAPHVIZ_VERSION_CHECK($GRAPHVIZ)
  META_TCLDOT_CHECK($GRAPHVIZ)
fi

AC_SUBST(GRAPHVIZ)

dnl Handle --with-tide=... argument to configure
AC_ARG_WITH(tide,
   [  --with-tide             TIDE is in DIR],
   TIDEDEF=-Dtide.enabled=true
   USE_TIDE=1,
   USE_TIDE=0
)
AC_SUBST(TIDEDEF)
AC_SUBST(USE_TIDE)

dnl Our own version of libdir whose value is set dynamically
AC_SUBST(INSTLIBDIR)
INSTLIBDIR="$libdir"

dnl Is ranlib needed on this system?
AC_PROG_RANLIB
AC_PATH_PROG(AR,ar,/usr/bin/ar)

dnl If anyone knows why this is used...
AC_AIX

dnl Where to locate a bourne-compatible shell?

dnl Where is perl5?
AC_PATH_PROGS(PERL,perl5 perl, /usr/bin/perl)

dnl What commands are needed to set the variable MAKE in Makefiles?
AC_SET_MAKE

dnl Determine which libraries to use for programs using sockets
NOSOCKLIBS=$LIBS
dnl first, the socket functions
SOCKET_FOUND=no
SOCKLIBS=
AC_CHECK_LIB(sun,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsun"])
if test ${SOCKET_FOUND} = no; then
  AC_CHECK_LIB(socket, socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsocket"])
  if test ${SOCKET_FOUND} = no; then
    AC_CHECK_LIB(bsd,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lbsd";DEFS="$DEFS -D_BSD=43"])
  fi
fi

dnl then gethostname
GHN_FOUND=no
AC_CHECK_LIB(sun,gethostname,[GHN_FOUND=yes])
if test ${GHN_FOUND} = no; then
  AC_CHECK_LIB(nsl,gethostname,[GHN_FOUND=yes;SOCKLIBS="$SOCKLIBS -lnsl"])
fi

AC_SUBST(SOCKLIBS)

LIBS=$NOSOCKLIBS


dnl Checks for header files.
AC_CHECK_HEADER(getopt.h)

dnl Which files need updating?
AC_OUTPUT(
   Makefile
   src/Makefile
   config/Makefile
   meta-studio/Makefile
   meta-studio/META-INF/Makefile
   meta-studio/scripts/Makefile
   meta-studio/images/Makefile
   meta-studio/metastudio/Makefile
   meta-studio/metastudio/graph/Makefile
   graph-browser/Makefile
   showdot/Makefile
   in-output/Makefile
   module-db/Makefile
   editors/Makefile
   editors/manager/Makefile
   editors/manager/src/Makefile
   editors/text/Makefile
   editors/structure/Makefile
   editors/structure/src/Makefile
   tbscripts/Makefile
   utils/Makefile
   configuration-manager/Makefile
   configuration-manager/src/Makefile
)
