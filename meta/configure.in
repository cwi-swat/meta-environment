dnl
dnl    Meta-Environment - An environment for language prototyping.
dnl    Copyright (C) 2000  Stichting Mathematisch Centrum, Amsterdam, The Netherlands. 
dnl
dnl    This program is free software; you can redistribute it and/or modify
dnl    it under the terms of the GNU General Public License as published by
dnl    the Free Software Foundation; either version 2 of the License, or
dnl    (at your option) any later version.
dnl
dnl    This program is distributed in the hope that it will be useful,
dnl    but WITHOUT ANY WARRANTY; without even the implied warranty of
dnl    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
dnl    GNU General Public License for more details.
dnl
dnl    You should have received a copy of the GNU General Public License
dnl    along with this program; if not, write to the Free Software
dnl    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
dnl
dnl $Id$

dnl Process this file with autoconf to produce a configure script.
AC_INIT(configure.in)
AM_INIT_AUTOMAKE(meta, 0.1.3)

dnl Default locations of used components
AC_PATH_PROG(TOOLBUS, toolbus, no)
if test "${TOOLBUS}" = "no"; then
	TOOLBUS='${prefix}'
else
	TOOLBUS=`dirname \`dirname ${TOOLBUS}\``
fi
dnl Handle --with-toolbus[-...]=... arguments to configure
AC_ARG_WITH(toolbus,
   [  --with-toolbus=DIR      ToolBus distribution is in DIR],
   TOOLBUS=${withval},)

AC_SUBST(TOOLBUS)


AC_PATH_PROG(ATERM, tifstoc, no)
if test "${ATERM}" = "no"; then
	ATERM='${prefix}'
else
	ATERM=`dirname \`dirname ${ATERM}\``
fi

dnl Handle --with-aterm=... argument to configure
AC_ARG_WITH(aterm,
   [  --with-aterm=DIR        ATerm-library is in DIR],
   ATERM=${withval},)

AC_SUBST(ATERM)

AC_PATH_PROG(ASFIX, asource, no)
if test "${ASFIX}" = "no"; then
	ASFIX='${prefix}'
else
	ASFIX=`dirname \`dirname ${ASFIX}\``
fi

dnl Handle --with-asfix=... argument to configure
AC_ARG_WITH(asfix,
   [  --with-asfix=DIR        ATerm-library is in DIR],
   ASFIX=${withval},)

AC_SUBST(ASFIX)


AC_PATH_PROG(SGLR, sglr, no)
if test "${SGLR}" = "no"; then
	SGLR='${prefix}'
else
	SGLR=`dirname \`dirname ${SGLR}\``
fi

dnl Handle --with-sglr=... argument to configure
AC_ARG_WITH(sglr,
   [  --with-sglr=DIR        sglr is in DIR],
   SGLR=${withval},)

AC_SUBST(SGLR)

AC_PATH_PROG(PGEN, parsetablegen, no)
if test "${PGEN}" = "no"; then
	PGEN='${prefix}'
else
	PGEN=`dirname \`dirname ${PGEN}\``
fi

dnl Handle --with-pgen=... argument to configure
AC_ARG_WITH(pgen,
   [  --with-pgen=DIR        pgen is in DIR],
   PGEN=${withval},)

AC_SUBST(PGEN)

AC_PATH_PROG(EVALUATOR, evaluator, no)
if test "${EVALUATOR}" = "no"; then
	EVALUATOR='${prefix}'
else
	EVALUATOR=`dirname \`dirname ${EVALUATOR}\``
fi

dnl Handle --with-evaluator=... argument to configure
AC_ARG_WITH(evaluator,
   [  --with-evaluator=DIR        evaluator is in DIR],
   EVALUATOR=${withval},)

AC_SUBST(EVALUATOR)

ASC_SUPPORT='${prefix}'

dnl Handle --with-asc-support=... argument to configure
AC_ARG_WITH(asc-support,
   [  --with-asc-support=DIR        asc-support is in DIR],
   ASC_SUPPORT=${withval},)

AC_SUBST(ASC_SUPPORT)

dnl ASFIX='${top_srcdir}/asfix'
dnl ASFIXBIN='$(ASFIX)'
dnl ASFIXINC='$(ASFIX)/libasfix'
dnl ASFIXLIB='$(ASFIX)/libasfix'
dnl 
dnl AC_SUBST(ASFIX)
dnl AC_SUBST(ASFIXBIN)
dnl AC_SUBST(ASFIXINC)
dnl AC_SUBST(ASFIXLIB)
dnl 
dnl ASC='${top_srcdir}/asc-support'
dnl ASCBIN='$(ASC)'
dnl ASCINC='$(ASC)'
dnl ASCLIB='$(ASC)'
dnl 
dnl AC_SUBST(ASC)
dnl AC_SUBST(ASCBIN)
dnl AC_SUBST(ASCINC)
dnl AC_SUBST(ASCLIB)

dnl Our own version of libdir iwhose value is set dynamically
AC_SUBST(INSTLIBDIR)
INSTLIBDIR="$libdir"

dnl Is ranlib needed on this system?
AC_PROG_RANLIB
AC_PATH_PROG(AR,ar,/usr/bin/ar)

AC_REQUIRE([AC_PROG_CC])

dnl Which compiler to use?
AC_PROG_CC

dnl If anyone knows why this is used...
AC_AIX

dnl Where to locate a bourne-compatible shell?

dnl Where is perl5?
AC_PATH_PROGS(PERL,perl5 perl, /usr/bin/perl)

dnl What commands are needed to set the variable MAKE in Makefiles?
AC_SET_MAKE



dnl Handle --with-tide=... argument to configure
AC_ARG_WITH(tide,
[  --with-tide		  TIDE is in DIR],
   TIDE=${withval}
   TIDEDEF=-DUSE_TIDE
   TIDEINC=-I${TIDE}
   USE_TIDE=1,
   USE_TIDE=0
)
AC_SUBST(TIDE)
AC_SUBST(TIDEDEF)
AC_SUBST(TIDEINC)
AC_SUBST(USE_TIDE)

dnl Handle --with-graphviz=... argument to configure
AC_ARG_WITH(graphviz,
   [  --with-graphviz=DIR     graphviz package is in DIR],
   GRAPHVIZ=${withval})
AC_SUBST(GRAPHVIZ)

dnl Handle --with-debug-c-code to activate c debug info 
dnl and shut off optimizations
CFLAGS="-Wall -O4 -DNDEBUG"
AC_ARG_WITH(debug-c-code,
   [ --with-debug-c-code      C flags set to -Wall -g],
   CFLAGS="-Wall -g -O2"
)
AC_SUBST(CFLAGS)

dnl Of course, the latest version of wish is not always called "wish". :-(
dnl If we can't find something called wish8.1 or wish8.0.1, we'll assume
dnl that "wish" is at version 8.0.1 or higher. This procedure really needs
dnl to be improved.
AC_PATH_PROGS(WISH,wish8.1 wish8.0.1 wish, /usr/bin/wish)

dnl Determine which libraries to use for programs using sockets
NOSOCKLIBS=$LIBS
dnl first, the socket functions
SOCKET_FOUND=no
SOCKLIBS=
AC_CHECK_LIB(sun,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsun"])
if test ${SOCKET_FOUND} = no; then
  AC_CHECK_LIB(socket, socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsocket"])
  if test ${SOCKET_FOUND} = no; then
    AC_CHECK_LIB(bsd,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lbsd";DEFS="$DEFS -D_BSD=43"])
  fi
fi

dnl then gethostname
GHN_FOUND=no
AC_CHECK_LIB(sun,gethostname,[GHN_FOUND=yes])
if test ${GHN_FOUND} = no; then
  AC_CHECK_LIB(nsl,gethostname,[GHN_FOUND=yes;SOCKLIBS="$SOCKLIBS -lnsl"])
fi

LIBS=$NOSOCKLIBS
AC_CHECK_LIB(dl, dlopen)

dnl Checks for header files.
AC_CHECK_HEADER(getopt.h)

AC_SUBST(SOCKLIBS)


dnl Which files need updating?
AC_OUTPUT(
   Makefile
   compiler/Makefile
   compiler/c-source/Makefile
   compiler/regress-test/Makefile
   compiler/regress-test/terms/Makefile
   asfix2c-compiler/Makefile
   graph-browser/Makefile
   graph-browser/graph-browser.tcl
   in-output/Makefile
   in-output/test/Makefile
   module-db/Makefile
   module-db/test/Makefile
   editors/Makefile
   editors/manager/Makefile
   editors/manager/src/Makefile
   editors/text/Makefile
   editors/structure/Makefile
   editors/structure/src/Makefile
   toolbus/Makefile
   toolbus/test/Makefile
   utils/Makefile
   utils/genmakefile
   grammars/Makefile
   grammars/aterm/Makefile
   grammars/asfix/Makefile
   grammars/sdf2/Makefile
   demo/Makefile
   demo/pico/Makefile
   demo/user-manual-examples/Makefile
   doc/Makefile
   doc/html/Makefile
   asf-syntax/Makefile
   asf-syntax/addeqs/Makefile
   asf-syntax/addeqs/src/Makefile
   asf-syntax/addeqs/c-source/Makefile
   asf-syntax/addeqs/spec/Makefile
   asf-syntax/removevars/Makefile
   asf-syntax/removevars/src/Makefile
   asf-syntax/removevars/c-source/Makefile
   asf-syntax/removevars/spec/Makefile
   asf-syntax/traversals/Makefile
   asf-syntax/traversals/src/Makefile
   asf-syntax/traversals/c-source/Makefile
   asf-syntax/traversals/spec/Makefile
   asf-syntax/traversals/test/Makefile
   asf-syntax/configmanager/Makefile
   asf-syntax/configmanager/src/Makefile
   parsetree/Makefile
   sdf/Makefile
   sdf/test/Makefile
, chmod +x utils/genmakefile
)


dnl Handle subpackages...
dnl AC_CONFIG_PKG(asfix)
dnl AC_CONFIG_PKG(asc-support, --with-asfix-inc='\${top_builddir}/../asfix/libasfix'
dnl                            --with-asfix-lib='\${top_builddir}/../asfix/libasfix')
dnl AC_CONFIG_PKG(sglr,        --with-asfix-inc='\${top_builddir}/../asfix/libasfix'
dnl                            --with-asfix-lib='\${top_builddir}/../asfix/libasfix')
dnl 
dnl AC_CONFIG_PKG(pgen,        --with-asfix-inc='\${top_builddir}/../asfix/libasfix'
dnl                            --with-asfix-lib='\${top_builddir}/../asfix/libasfix'
dnl                            --with-asc-inc='\${top_builddir}/../asc-support'
dnl                            --with-asc-lib='\${top_builddir}/../asc-support'
dnl                            --with-sglr='\${top_builddir}/../sglr/sglr')
dnl 
dnl AC_CONFIG_PKG(evaluator,   --with-asfix-inc='\${top_builddir}/../asfix/libasfix'
dnl                            --with-asfix-lib='\${top_builddir}/../asfix/libasfix'
dnl                            --with-asc-inc='\${top_builddir}/../asc-support'
dnl                            --with-asc-lib='\${top_builddir}/../asc-support' )
