#
#    Meta-Environment - An environment for language prototyping.
#    Copyright (C) 2000  Stichting Mathematisch Centrum, Amsterdam, The Netherlands. 
#
#    This program is free software; you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation; either version 2 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with this program; if not, write to the Free Software
#    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
#
# @configure_input@
# Directory: new-meta

# Configure variable substitutions
PRODUCT		= @PRODUCT@
VERSION		= @VERSION@

@SET_MAKE@

srcdir		= @srcdir@
VPATH		= @srcdir@
top_srcdir	= @top_srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
libdir		= @libdir@
includedir	= @includedir@
datadir		= @datadir@
classdir        = ${prefix}/classes/nl/cwi/gipe/stred

SHELL		= @SHELL@

INSTALL		= @INSTALL@
INSTALL_DATA	= @INSTALL_DATA@
INSTALL_PROG	= @INSTALL_PROG@
UNINSTALL	= @UNINSTALL@

# Ordering is important here: the toolbus dir. should come first
SUBDIRS		= asfix toolbus editor evaluator graph-browser \
		  in-output module-db asc-support compiler stred \
		  asfix2c-compiler sglr pgen utils grammars

BINFILES        = meta

# .SILENT:

all doc clean test:	configure
	@set -e; for DIR in $(SUBDIRS);	\
	do \
		$(MAKE) -${MAKEFLAGS} -C $$DIR $@; \
	done

configure:	configure.in
	@echo "Warning: configure script is out of date."
	@echo "Please (re)run autoconf and configure."

uninstall:
	$(UNINSTALL) $(bindir) meta
	@for DIR in $(SUBDIRS);	\
	do \
		echo Make $@ in $$DIR; \
		cd $$DIR; \
		$(MAKE) $@; \
		cd ..; \
	done

licensed:
	@clear; echo "Please read the following license carefully."; \
		sleep 2; sed -e 's/^/    /' COPYING |more; echo ""; \
		echo "Do you accept this license? [no] "; read accept; \
		case "$$accept" in	\
			[yY]*)	echo License accepted by `whoami`@`hostname` on `date` > $@ ;; \
			*)	false ;; \
		esac

install:	licensed
	mkdir -p $(bindir) $(libdir) $(includedir) $(datadir) $(classdir)
	$(INSTALL_PROG) $(INSTALL) $(bindir) $(BINFILES)
	@for DIR in $(SUBDIRS);	\
	do \
		echo Make $@ in $$DIR; \
		cd $$DIR; \
		$(MAKE) $@; \
		cd ..; \
	done

distclean:
	rm -f Makefile Makefile.skel config.cache config.log config.status
	rm -f meta
	@for DIR in $(SUBDIRS);	\
	do \
		echo Make $@ in $$DIR; \
		cd $$DIR; \
		$(MAKE) $@; \
		cd ..; \
	done

# Get `dist' target from separate Makefile.dist, so we can always
# explicitly build `dist' using "gmake -f Makefile.dist dist"
include	Makefile.dist

# ObTribute to Larry Wall
love:
	@echo "not war"

depend:
