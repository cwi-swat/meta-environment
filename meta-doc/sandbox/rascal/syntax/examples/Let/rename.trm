fun Exp rename(Exp E, rel[Var,Var] Rn, Int Cnt) {

    switch E {

      let <V> = <Exp E1> in <Exp E2> end => let <Var Y> = <Exp R1> in <Exp R2> end
          when Var Y := "x" + Cnt, 
             int Cnt1 := Cnt + 1,
             Exp R1 := rename(E1, Rn, Cnt),
             Exp R2 := rename(E2, {<V, Y>} union R1, Cnt1)

      [| <Var V> |] => V1 
        when { <Var V1> } <- Rn[V]

      <Exp E> => E
   }
}