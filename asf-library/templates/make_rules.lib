include ${top_srcdir}/templates/make_rules
libpackagedir = ${pkgdatadir}$(subst $(LIBROOT),,$(subdir))

MODULES=$(wildcard *.asf *.sdf) 
PREPARED=$(wildcard *.tbl)
BUILTIN_SRC=$(wildcard *.c)

INSTALL_READONLY = ${INSTALL} -m 0444

EXTRA_DIST = $(MODULES) $(PREPARED) $(BUILTIN_SRC)

install-data-hook: make-dir install-modules install-prepared make-read-only

make-dir:
	chmod u+w $(DESTDIR)$(libpackagedir)
	$(mkinstalldirs) $(DESTDIR)$(libpackagedir)

install-modules:
	@list='$(MODULES)'; for p in $$list; do \
          if test -f $(srcdir)/$$p; then \
            echo " $(INSTALL_READONLY) $(srcdir)/$$p $(DESTDIR)$(libpackagedir)/$$p"; \
            $(INSTALL_READONLY) $(srcdir)/$$p $(DESTDIR)$(libpackagedir)/$$p; \
          else if test -f $$p; then \
            echo " $(INSTALL_READONLY) $$p $(DESTDIR)$(libpackagedir)/$$p"; \
            $(INSTALL_READONLY) $$p $(DESTDIR)$(libpackagedir)/$$p; \
          fi; fi; \
        done; 

install-prepared:
	@list='$(PREPARED)'; for p in $$list; do \
          if test -f $(srcdir)/$$p; then \
            echo " $(INSTALL_READONLY) $(srcdir)/$$p $(DESTDIR)$(libpackagedir)/$$p"; \
            $(INSTALL_READONLY) $(srcdir)/$$p $(DESTDIR)$(libpackagedir)/$$p; \
          else if test -f $$p; then \
            echo " $(INSTALL_READONLY) $$p $(DESTDIR)$(libpackagedir)/$$p"; \
            $(INSTALL_READONLY) $$p $(DESTDIR)$(libpackagedir)/$$p; \
          fi; fi; \
        done;

make-read-only:
	chmod ugo-w $(DESTDIR)$(libpackagedir) 
