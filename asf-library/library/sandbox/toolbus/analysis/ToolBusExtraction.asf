equations

  [extractRelations-start]
    extractRelations($TscriptDefs) = extractRelations($TscriptDefs, [])

  [extractRelations-process]
    extractRelations($ProcessDef, $Rstore)
	= findVarInProcess($ProcessDef, $Rstore, get-area($ProcessDef))

  [extractRelations-vardecl]
    $Tuple = <$ProcessDefId, var2str($Var)>,
    $Rstore2 = add-tuple(DECLS, $Tuple, $Rstore1),
    $Tuple2 = <$Tuple, get-area($Var)>,
    $Rstore3 = add-tuple(DECL_OCCURS, $Tuple2, $Rstore2)
    ===>
    findVarInProcess($Var : $Term, $Rstore1, $ProcessDefId) = $Rstore3

  [extractRelations-genvar]
    $VarId = get-area($Var),
    $Tuple = <$ProcessDefId, var2str($Var)>,
    $Rstore2 = add-tuple(USES, $Tuple, $Rstore1),
    $Tuple2 = <$Tuple, $VarId>,
    $Rstore3 = add-tuple(USE_OCCURS, $Tuple2, $Rstore2)
    ===>
    findVarInProcess($Var, $Rstore1, $ProcessDefId) = $Rstore3

  [extractRelations-genvar-q]
    $VarId = get-area($Var),
    $Tuple = <$ProcessDefId, var2str($Var)>,
    $Rstore2 = add-tuple(DEFS, $Tuple, $Rstore1),
    $Tuple2 = <$Tuple, $VarId>,
    $Rstore3 = add-tuple(DEF_OCCURS, $Tuple2, $Rstore2)
    ===>
    findVarInProcess($Var?, $Rstore1, $ProcessDefId) = $Rstore3

  [extractRelations-genvar-q]
    $VarId = get-area($Var),
    $Tuple = <$ProcessDefId, var2str($Var)>,
    $Rstore2 = add-tuple(DEFS, $Tuple, $Rstore1),
    $Tuple2 = <$Tuple, $VarId>,
    $Rstore3 = add-tuple(DEF_OCCURS, $Tuple2, $Rstore2),
    $Rstore4 = findVarInProcess($Term, $Rstore3, $ProcessDefId)
    ===>
    findVarInProcess($Var := $Term, $Rstore1, $ProcessDefId) = $Rstore4