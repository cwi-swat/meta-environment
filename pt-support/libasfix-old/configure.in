dnl
dnl    AsFix -- The AsFix (ASF+SDF Prefix) library
dnl    Copyright (C) 1998-2000  Stichting Mathematisch Centrum, Amsterdam, 
dnl                             The  Netherlands.
dnl
dnl    This program is free software; you can redistribute it and/or modify
dnl    it under the terms of the GNU General Public License as published by
dnl    the Free Software Foundation; either version 2 of the License, or
dnl    (at your option) any later version.
dnl
dnl    This program is distributed in the hope that it will be useful,
dnl    but WITHOUT ANY WARRANTY; without even the implied warranty of
dnl    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
dnl    GNU General Public License for more details.
dnl
dnl    You should have received a copy of the GNU General Public License
dnl    along with this program; if not, write to the Free Software
dnl    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
dnl
dnl Process this file with autoconf to produce a configure script.
dnl
dnl $Id$

AC_INIT(Makefile.in)
AM_INIT_AUTOMAKE(asfix, 0.2)

dnl Default values
CC_GCC=gcc
CFLAGS_GCC="-Wall -O4"
LFLAGS_GCC=""
DEFS_GCC="\$(DEFS) -DNDEBUG"
INCL_GCC=""

CC_CC=cc
CFLAGS_CC="-O"
LFLAGS_CC=""
DEFS_CC="\$(DEFS) -DNDEBUG"
INCL_CC=""

CC_DBG=gcc
CFLAGS_DBG="-Wall -g"
LFLAGS_DBG="-g"
DEFS_DBG="\$(DEFS)"
INCL_DBG=""

CC_PROF=gcc
CFLAGS_PROF="-Wall -pg"
LFLAGS_PROF="-pg"
DEFS_PROF="\$(DEFS)"
INCL_PROF=""

CC_CC64=cc
CFLAGS_CC64=""
LFLAGS_CC64="-64"
DEFS_CC64="\$(DEFS)"
INCL_CC64=""

CC_SHARED=gcc
CFLAGS_SHARED="-Wall"
LFLAGS_SHARED=""
DEFS_SHARED="\$(DEFS)"
INCL_SHARED=""

AC_PROG_CC

CURDATE=`date`

AC_PROG_RANLIB
AR=ar
AC_SUBST(AR)

AC_AIX

AC_SET_MAKE

AC_PATH_PROG(ATERM, tifstoc, no)
if test "${ATERM}" = "no"; then
         ATERM='${prefix}'
else
         ATERM=`dirname \`dirname ${ATERM}\``
fi

dnl Handle --with-aterm=... argument to configure
AC_ARG_WITH(aterm,
   [  --with-aterm=DIR        ATerm-library is in DIR], ATERM=${withval})
AC_SUBST(ATERM)

AC_ARG_WITH(aterm-bin,
   [  --with-aterm-bin=DIR    ATerm executables are in DIR],
   ATERMBIN=${withval},ATERMBIN=${ATERM}/bin)
AC_SUBST(ATERMBIN)

AC_ARG_WITH(aterm-lib,
   [  --with-aterm-lib=DIR    ATerm libraries are in DIR],
   ATERMLIB=${withval},ATERMLIB=${ATERM}/lib)
AC_SUBST(ATERMLIB)

AC_ARG_WITH(aterm-inc,
   [  --with-aterm-inc=DIR    ATerm header files are in DIR],
   ATERMINC=${withval},ATERMINC=${ATERM}/include)
AC_SUBST(ATERMINC)

AC_ARG_WITH(toolbus, 
   [  --with-toolbus      Specify location of the ToolBus], 
   TOOLBUS=$withval)

if test "a${TOOLBUS}" = "a"; then
 dnl Try to find the location of the toolbus
 AC_CHECK_PROG(TOOLBUS,toolbus,toolbus,false)
 if test ${TOOLBUS} = "false" 
 then
   echo "Warning: toolbus not found. You might need it when developing the AsFix library." >&2
   TOOLBUS="toolbus"
 fi
fi

AC_ARG_WITH(gcc,
   [  --with-gcc          create gcc version of the library (libAsFix-gcc.a)],
      ASFIX_LIB_GCC=libAsFix-gcc.a)

AC_ARG_WITH(cc,
   [  --with-cc           create cc version of the library (libAsFix-cc.a)],
      ASFIX_LIB_CC=libAsFix-cc.a)

AC_ARG_WITH(dbg,
   [  --with-dbg          create debug version of the library (libAsFix-dbg.a)],
      ASFIX_LIB_DBG=libAsFix-dbg.a)

AC_ARG_WITH(prof,
   [  --with-prof         create debug version of the library (libAsFix-prof.a)],
      ASFIX_LIB_PROF=libAsFix-prof.a)


AC_ARG_WITH(all,
   [  --with-all          create all libraries (--with-{gcc,cc,dbg,prof})],
      ASFIX_LIB_GCC=libAsFix-gcc.a
      ASFIX_LIB_CC=libAsFix-cc.a
      ASFIX_LIB_DBG=libAsFix-dbg.a
      ASFIX_LIB_PROF=libAsFix-prof.a)

AC_SUBST(ASFIX_LIB_GCC)
AC_SUBST(ASFIX_LIB_CC)
AC_SUBST(ASFIX_LIB_DBG)
AC_SUBST(ASFIX_LIB_PROF)
AC_SUBST(ASFIX_LIB_SHARED)
AC_SUBST(ASFIX_LIB_CC64)

AC_SUBST(CC_GCC)
AC_SUBST(CC_CC)
AC_SUBST(CC_DBG)
AC_SUBST(CC_PROF)

AC_SUBST(CFLAGS_CC)
AC_SUBST(CFLAGS_GCC)
AC_SUBST(CFLAGS_DBG)
AC_SUBST(CFLAGS_PROF)

AC_SUBST(DEFS_CC)
AC_SUBST(DEFS_GCC)
AC_SUBST(DEFS_DBG)
AC_SUBST(DEFS_PROF)

AC_SUBST(INCL_CC)
AC_SUBST(INCL_GCC)
AC_SUBST(INCL_DBG)
AC_SUBST(INCL_PROF)

AC_SUBST(LFLAGS_CC)
AC_SUBST(LFLAGS_GCC)
AC_SUBST(LFLAGS_DBG)
AC_SUBST(LFLAGS_PROF)

AC_HAVE_FUNCS(strdup)

dnl Find out which libraries we need

SOCKET_FOUND=no
AC_CHECK_LIB(sun,socket,[SOCKET_FOUND=yes;LIBS="$LIBS -lsun"])
if test ${SOCKET_FOUND} = no; then
   AC_CHECK_LIB(socket, socket,[SOCKET_FOUND=yes;LIBS="$LIBS -lsocket"])
   if test ${SOCKET_FOUND} = no; then
      AC_CHECK_LIB(bsd,
                   socket,
                   [SOCKET_FOUND=yes;LIBS="$LIBS -lbsd";DEFS="$DEFS -D_BSD=43"]
)
   fi
fi

AC_CHECK_LIB(dl, dlopen)

GETHOSTNAME_FOUND=no
AC_CHECK_LIB(sun,gethostname,[GETHOSTNAME_FOUND=yes])
if test ${GETHOSTNAME_FOUND} = no; then
   AC_CHECK_LIB(nsl,gethostname,[GETHOSTNAME_FOUND=yes;LIBS="$LIBS -lnsl"])
fi

AC_OUTPUT(
	Makefile
	libasfix/Makefile
        asfix-tools/Makefile
	test/Makefile
)

