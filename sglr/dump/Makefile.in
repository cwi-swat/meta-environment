# $Id$

# Configure variable substitutions
PRODUCT		= @PRODUCT@
VERSION		= @VERSION@

@SET_MAKE@
VPATH		= @srcdir@
srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= ${exec_prefix}/bin
libdir		= ${exec_prefix}/lib
includedir	= ${prefix}/include
docdir		= ${top_srcdir}/docs

SHELL		= @SHELL@

AR              = @AR@
AR_FLAGS        = cr

CC		= @CC@
CFLAGS		= @CFLAGS@ ${XCFLAGS}
CFLAGSPROF	= -pg ${CFLAGS}
CPP		= @CPP@
CPPFLAGS	= @CPP@ ${XCPPFLAGS}
LDFLAGS         = -g
LDFLAGSPROF     = ${LDFLAGS} -pg

MAKE		= gmake

DEFS		= @DEFS@
INCLUDES	= @INCLUDES@ ${XINCLUDES}
LIBS		= ${XLIBS} @LIBS@ ${SOCKLIBS}
SOCKLIBS	= @SOCKLIBS@

INSTALL		= @INSTALL@
INSTALL_DATA	= @INSTALL_DATA@
INSTALL_PROG	= @INSTALL_PROG@
UNINSTALL	= @UNINSTALL@

ATERM           = @ATERM@
TOOLBUS         = @TOOLBUS@


A2TOA1DIR	= ${top_srcdir}/sglr/a2toa1
PARSERDIR	= ${top_srcdir}/sglr/parser
TREE2DOTDIR	= ${top_srcdir}/sglr/tree2dot

XCFLAGS		= ${DEFS}
XINCLUDES	= -I${PARSERDIR} -I${ATERM}/include
ATLIBS		= -lATerm -lAsFix -lATB
XLIBS		=  -L${A2TOA1DIR} -L${PARSERDIR} -L${TREE2DOTDIR} -L${libdir}	\
		   -lsglr -la2toa1 -ltree2dot ${addsuffix -${CC},${ATLIBS}}

PROG		= dump-actions dump-gotos dump-priorities dump-productions
OBJ		= ${addsuffix .o,${PROG}}
SRC		= dump-parse-table.c

all:	${PROG}

.SILENT:	depend

install:	bininstall
	@true

incinstall:	${DUMPINCLUDES}
	@for INC in ${DUMPINCLUDES};	\
	do \
		${INSTALL_DATA} ${INSTALL} ${includedir} $$INC; \
	done

libinstall:	${DUMPLIBS}
	@for LIB in ${DUMPLIBS};	\
	do \
		${INSTALL_DATA} ${INSTALL} ${libdir} $$LIB; \
	done

bininstall:	${PROG}
	@for PROG in ${PROG};	\
	do \
		${INSTALL_PROG} ${INSTALL} ${bindir} $$PROG; \
	done

distclean realclean spotless:	clean
	rm -f	depend Makefile ${DUMPLIBS}

clean:
	rm -f	core ${PROG} ${OBJ}


dump-actions dump-gotos	\
dump-priorities dump-productions:	${SRC}
	${CC} -DPTPART=${subst dump-,,${basename $@}} ${CFLAGS} ${INCLUDES} $< ${LIBS} -o $@


# ObTribute to Larry Wall
love:
	@echo "not war"


# Handle dependencies
depend: ${SRC}
	makedepend ${INCLUDES} ${SRC}	 -f- | 	\
		sed -e "s/^${patsubst %.c,%.o,${SRC}}:/${PROG}:/"	> $@

-include depend
