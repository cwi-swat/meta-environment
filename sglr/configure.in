dnl
dnl    Meta-Environment - An environment for language prototyping.
dnl    Copyright (C) 2000  Stichting Mathematisch Centrum, Amsterdam, The Netherlands. 
dnl
dnl    This program is free software; you can redistribute it and/or modify
dnl    it under the terms of the GNU General Public License as published by
dnl    the Free Software Foundation; either version 2 of the License, or
dnl    (at your option) any later version.
dnl
dnl    This program is distributed in the hope that it will be useful,
dnl    but WITHOUT ANY WARRANTY; without even the implied warranty of
dnl    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
dnl    GNU General Public License for more details.
dnl
dnl    You should have received a copy of the GNU General Public License
dnl    along with this program; if not, write to the Free Software
dnl    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
dnl
dnl $Id$

dnl Process this file with autoconf to produce a configure script.
AC_INIT(configure.in)
AM_INIT_AUTOMAKE(sdf, 0.1)

ACLOCAL="${ACLOCAL} -I ."

dnl Check for required packages and perform version check when needed.

dnl Require ATerm library
AC_PACKAGE_REQUIRE(aterm, tifstoc,
   [  --with-aterm=DIR        ATerm-library is in DIR])
AC_SUBST(ATERM)

dnl Required for generated Makefile.am's to work until genamakefile patched:
ATERMINC=${ATERM}/include
ATERMLIB=${ATERM}/lib
AC_SUBST(ATERMINC)
AC_SUBST(ATERMLIB)

dnl Require toolbus package
AC_PACKAGE_REQUIRE(toolbus, toolbus,
   [  --with-toolbus=DIR      ToolBus distribution is in DIR])
AC_SUBST(TOOLBUS)

dnl Require PT package (for AsFix)
AC_PACKAGE_REQUIRE(pt-support, asource,
   [  --with-pt-support=DIR   ParseTree distribution is in DIR])
AC_SUBST(PT_SUPPORT)

ASC_SUPPORT='${prefix}'
dnl Handle --with-asc-support=... argument to configure
AC_ARG_WITH(asc-support,
   [  --with-asc-support=DIR  asc-support is in DIR],
   ASC_SUPPORT=${withval},)

AC_SUBST(ASC_SUPPORT)

dnl Again for Asc (fix for generated Makefile.am's)
ASCINC=${ASC_SUPPORT}/include
ASCLIB=${ASC_SUPPORT}/lib
AC_SUBST(ASCINC)
AC_SUBST(ASCLIB)

dnl Our own version of libdir whose value is set dynamically
AC_SUBST(INSTLIBDIR)
INSTLIBDIR="$libdir"

dnl Is ranlib needed on this system?
AC_PROG_RANLIB
AC_PATH_PROG(AR,ar,/usr/bin/ar)

AC_REQUIRE([AC_PROG_CC])

dnl Which compiler to use?
AC_PROG_CC

dnl What commands are needed to set the variable MAKE in Makefiles?
AC_SET_MAKE

dnl Determine which libraries to use for programs using sockets
NOSOCKLIBS=$LIBS
dnl first, the socket functions
SOCKET_FOUND=no
SOCKLIBS=
AC_CHECK_LIB(sun,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsun"])
if test ${SOCKET_FOUND} = no; then
  AC_CHECK_LIB(socket, socket,[SOCKET_FOUND=yes;SOCKLIBS="-lsocket"])
  if test ${SOCKET_FOUND} = no; then
    AC_CHECK_LIB(bsd,socket,[SOCKET_FOUND=yes;SOCKLIBS="-lbsd";DEFS="$DEFS -D_BSD=43"])
  fi
fi

dnl then gethostname
GHN_FOUND=no
AC_CHECK_LIB(sun,gethostname,[GHN_FOUND=yes])
if test ${GHN_FOUND} = no; then
  AC_CHECK_LIB(nsl,gethostname,[GHN_FOUND=yes;SOCKLIBS="$SOCKLIBS -lnsl"])
fi

AC_SUBST(SOCKLIBS)

LIBS=$NOSOCKLIBS

AC_CHECK_LIB(dl, dlopen)

dnl Checks for header files.
AC_CHECK_HEADER(getopt.h)

dnl Which files need updating?
AC_OUTPUT(
   Makefile
   lib/Makefile
   sglr/Makefile
   sglr/doc/Makefile
   sglr/dump/Makefile
   sglr/libsglr/Makefile
   sglr/ambtracker/Makefile
   sglr/sglr/Makefile
   sglr/libtree2dot/Makefile
   sglr/tree2dot/Makefile
   sglr/client/Makefile
   sglr/sdf1tosdf2/Makefile
   sglr/sdf1tosdf2/sdf1tosdf2
   sglr/test/Makefile
   sglr/test/erroneous/Makefile
   sglr/test/first/Makefile
   sglr/test/tables/Makefile
   sglr/test/terms/Makefile
   pgen/Makefile 
   pgen/c-lib/Makefile 
   pgen/c-source/Makefile 
   pgen/src/Makefile 
   pgen/grammar/Makefile 
   pgen/sdf2stats/Makefile 
   pgen/normalizer/Makefile
   pgen/test/Makefile
   pgen/test/first/Makefile
   pgen/test/grammars/Makefile
   pgen/test/tables/Makefile 
  , chmod +x sglr/test/regress-terms pgen/test/regress-lang
)
