#! /bin/sh
# $Id$

PERL5=@PERL@

A=/tmp/$$.0
B=/tmp/$$.1

breakers="actions|amb|appl|goto|label|priorities|state-rec"
break="s/($breakers)/\n\$1/g";

case $# in
	2)
		if [ -f $1 -a -f $2 ] ; then
			:
		else
			echo "Either $1 or $2 does not exist"
			exit 1
		fi
		if [ $1 = $2 ] ; then exit 0; fi ;;
	*)
		echo "Usage:" `basename $0` "file0 file1"
		exit 2 ;;
esac

CheckSum () {
	cksum $1 | cut -f1,2
}

BinaryEqual () {
	if cmp -s $1 $2 ; then return 0 ;  else return 1 ; fi

	if [ "`CheckSum $1`" = "`CheckSum $2`" ] ; then
		return 0
	else
		return 1
	fi
}

if BinaryEqual $1 $2 ; then exit 0 ; fi

echo === not binary identical -- text diff for `basename $1`/`basename $2` ===

trap 'rm -f $A $B' 0 1
trmcat $1 | $PERL5 -pe "$break"	> $A
trmcat $2 | $PERL5 -pe "$break"	> $B
diff $A $B

echo "==="
