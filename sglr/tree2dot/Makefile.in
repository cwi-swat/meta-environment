# $Id$
# Directory: sglr/src

# Configure variable substitutions
PRODUCT		= @PRODUCT@
VERSION		= @VERSION@

@SET_MAKE@
VPATH		= @srcdir@
srcdir		= @srcdir@
top_srcdir	= @top_srcdir@
prefix		= @prefix@
exec_prefix	= @exec_prefix@
bindir		= @bindir@
libdir		= @libdir@
includedir	= @includedir@
docdir		= ${top_srcdir}/docs

SHELL		= @SHELL@

AR              = @AR@
AR_FLAGS        = cr

MAKEDEPEND	= @MAKEDEPEND@
CC		= @CC@
CFLAGS		= @CFLAGS@ ${XCFLAGS}
CFLAGSPROF	= -pg ${CFLAGS}
CPP		= @CPP@
CPPFLAGS	= @CPP@ ${XCPPFLAGS}
LDFLAGS         = -g
LDFLAGSPROF     = ${LDFLAGS} -pg

DEFS		= @DEFS@
INCLUDES	= @INCLUDES@ ${XINCLUDES}
LIBSALL		= -L. -L${PARSERDIR} -L${A2TOA1DIR} -L${libdir} @LIBS@ ${SOCKLIBS}
LIBS		= ${LIBSALL} ${XLIBS}
LIBSPROF	= ${LIBSALL} ${XLIBSPROF}
SOCKLIBS	= @SOCKLIBS@

INSTALL		= @INSTALL@
INSTALL_DATA	= @INSTALL_DATA@
INSTALL_PROG	= @INSTALL_PROG@
UNINSTALL	= @UNINSTALL@

ATERM		= @ATERM@
ATERMBIN	= @ATERMBIN@
ATERMLIB	= @ATERMLIB@
ATERMINC	= @ATERMINC@
TOOLBUS		= @TOOLBUS@
TOOLBUSBIN	= @TOOLBUSBIN@
TOOLBUSLIB	= @TOOLBUSLIB@
TOOLBUSINC	= @TOOLBUSINC@

A2TOA1DIR	= ${srcdir}/../a2toa1
PARSERDIR	= ${srcdir}/../parser

# The eXtra parts of some variables
XCFLAGS		= ${DEFS}

XINCLUDES	= -I${PARSERDIR} -I${ATERM}/include
ATLIBS 		= -lATerm -lAsFix -lATB
XLIBS		= -L$(ATERMLIB) -ltree2dot -lsglr -la2toa1 ${addsuffix -${CC},${ATLIBS}}

LIBSRC          = tree-to-dot.c
LIBOBJ		= ${patsubst %.c,%.o,${LIBSRC}}

PROG		= tree2dot
MAIN		= ${PROG}-main.c
OBJ		= ${patsubst %.c,%.o,${MAIN}}

BINFILES	= ${PROG}
INCLUDEFILES	=
LIBFILES	= libtree2dot.a

all:	${BINFILES}

libs:	${LIBFILES}

.SILENT:	depend

# install target (install binaries, include files, and libraries)
install: all
	mkdir -p $(bindir) $(libdir) $(includedir)
	@$(INSTALL_PROG) $(INSTALL) $(bindir) $(BINFILES)
	@$(INSTALL_DATA) $(INSTALL) $(libdir) $(LIBFILES)
	@$(INSTALL_DATA) $(INSTALL) $(includedir) $(INCLUDEFILES)

# uninstall target (remove all files installed by 'install' target)
uninstall:
	@$(UNINSTALL) $(bindir) $(BINFILES)
	@$(UNINSTALL) $(libdir) $(LIBFILES)
	@$(UNINSTALL) $(includedir) $(INCLUDEFILES)

distclean realclean spotless:	clean
	rm -f	Makefile

clean:
	rm -f	core depend ${PROG} ${OBJ} ${LIBOBJ} ${LIBFILES}

# Generic rules

%.o:	%.c
	${CC} ${CFLAGS} ${INCLUDES} -c $<


# Specific dependencies

libtree2dot.a:  ${LIBOBJ}
	${AR} ${AR_FLAGS} $@ ${LIBOBJ}

tree2dot:	${LIBFILES} ${OBJ}
	${CC} ${LDFLAGS} ${OBJ} ${LIBS} -o $@

# ObTribute to Larry Wall
love:
	@echo "not war"

# Handle dependencies
depend: ${LIBSRC} ${MAIN}
	${MAKEDEPEND} ${INCLUDES} ${LIBSRC} ${MAIN} > $@

-include depend
