definition

module Equations
imports Characters
exports
  sorts Equations

hiddens
  sorts Tag TagId CondEquation Equation Implies Condition Equations
exports
  lexical syntax
    "===" [\=]* [\>]?  -> Implies {cons("default")}
    [A-Za-z0-9\"\']                                  -> TagId {avoid,cons("one-char")}
    [A-Za-z0-9\"\'][A-Za-z0-9\"\'\-]*[A-Za-z0-9\"\'] -> TagId {avoid,cons("many-chars")}
     
  lexical restrictions
    Implies -/- [\=]

  context-free syntax

    list:{Condition ","}+           -> Conditions
                                    -> Equations {cons("absent")} 
    "equations" list:CondEquation*  -> Equations {cons("present")}

    Tag Equation                    -> CondEquation {cons("simple")}
    Tag Conditions Implies Equation -> CondEquation {cons("implies")}
    Tag Equation "when" Conditions  -> CondEquation {cons("when")}

    "[" "]"                         -> Tag {cons("empty")}
    "[" TagId "]"                   -> Tag {cons("not-empty")}

module GEN-LexConsFuncs

%% This module defines the syntax for 'lexical constructor functions'
%% for each sort in an ASF+SDF specification. So in reality, this module
%% is generated (hence the name "GEN-*").

imports Characters

exports
  context-free syntax

%% FOR EACH Sort in ASF+SDF SPEC DO
%%   Tree := Sort;
%%   term := tolower(Sort);
%%   ADD PRODUCTIONS {

       name:Tree "(" list:CHAR* ")" -> Tree {cons("lexical-constructor")}

%%   }
%% NEXT Sort

  context-free syntax


module GEN-Equations

  %% This module defines the syntax for ASF equations and conditions for
  %% each sort in an ASF+SDF specification. So in reality, this module is
  %% generated (hence the name "GEN-*").

imports GEN-LexConsFuncs Equations

exports
   context-free syntax

%% FOR EACH Sort IN ASF+SDF SPEC DO
%%   Tree := Sort;
%%   ADD PRODUCTIONS {
       lhs:Tree          "=" rhs:Tree -> Equation
       lhs:Tree          "=" rhs:Tree -> Condition {cons("positive")}
       lhs:Tree unequal:"!=" rhs:Tree -> Condition {cons("negative")}
       "amb" "(" ambs:{Tree ","}* ")" -> Tree      {cons("ambiguity-constructor")}
%%   }
%% NEXT Sort
   context-free syntax

module Characters
hiddens
  sorts CHAR
exports
  lexical syntax
    [\"] value:~[\257] [\"]         -> CHAR {cons("default")}

module Main
  imports GEN-Equations

